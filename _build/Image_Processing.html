---
redirect_from:
  - "/image-processing"
interact_link: content/Image_Processing.ipynb
kernel_name: julia-1.3
has_widgets: false
title: |-
  Image Processing
prev_page:
  url: /Computational_Geometry.html
  title: |-
    Computational Geometry
next_page:
  url: /Differential_Equations.html
  title: |-
    Differential Equations
suffix: .ipynb

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Image-Processing">Image Processing<a class="anchor-link" href="#Image-Processing"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reading-and-plotting-images">Reading and plotting images<a class="anchor-link" href="#Reading-and-plotting-images"> </a></h2><p>Julia provides a large set of image processing functions in the <code>Images</code> package. However, here we will focus on the mathematics and the algorithm behind some of these functions, and work directly on the arrays.</p>
<p>We will use <code>PyPlot</code> to read and plot images, as shown below:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">using</span> <span class="n">PyPlot</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&quot;sample_photo.png&quot;</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_2_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using standard Julia functions, we can determine that the image is represented in a 3-dimensional array of <code>Float32</code>, with values between 0 and 1:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">println</span><span class="p">(</span><span class="s">&quot;A is of type </span><span class="si">$</span><span class="p">(</span><span class="n">typeof</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="s"> with dimensions </span><span class="si">$</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s">&quot;The values of A range between </span><span class="si">$</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="s"> and </span><span class="si">$</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>A is of type Array{Float32,3} with dimensions (684, 912, 3)
The values of A range between 0.0 and 1.0
</pre>
</div>
</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here, the first 2 dimensions are row and the column indices of the pixels in the image, and the 3rd dimension of length 3 correspond to the RGB (Red-Green-Blue) components of the corresponding color.</p>
<p>It is convenient to work with <code>Float</code> numbers, however, images are normally stored as <code>UInt8</code> with only 256 integer values for each RGB components. This is also supported by PyPlot, but for simplicity we will use the <code>Float32</code> format here.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="RGB-values,-Grayscale-images">RGB values, Grayscale images<a class="anchor-link" href="#RGB-values,-Grayscale-images"> </a></h3><p>To illustrate how the RGB components build up the color of each pixel, we can build and plot new images which only contain each of the components:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Ar</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">A</span><span class="p">);</span> <span class="n">Ar</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span> <span class="o">.=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">Ag</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">A</span><span class="p">);</span> <span class="n">Ag</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span> <span class="o">.=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">Ab</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">A</span><span class="p">);</span> <span class="n">Ab</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="o">.=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">imshow</span><span class="p">(</span><span class="n">Ar</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="n">imshow</span><span class="p">(</span><span class="n">Ag</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="n">imshow</span><span class="p">(</span><span class="n">Ab</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span> <span class="n">imshow</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_7_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The image algorithms we will cover here are easiest understood by considering a single component instead of the full RGB color (such as the <em>intensity</em> or the <em>brightness</em> of each pixel). Here we simply find the average of each color component, and treat the resulting array as a grayscale image:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">using</span> <span class="n">Statistics</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="mi">3</span><span class="p">)[</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="k">function</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="c"># Like imshow(A) but scales the values to [0,1] and supports grayscale</span>
    
    <span class="n">A</span> <span class="o">.-=</span> <span class="n">minimum</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>            <span class="c"># Scale and shift to [0,1]</span>
    <span class="n">A</span> <span class="o">./=</span> <span class="n">maximum</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ndims</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c"># Set R=G=B for grayscale</span>
    <span class="k">end</span>
    <span class="n">imshow</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">imshow_scale</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_9_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will also sometimes consider <em>binary images</em>, which only contains two colors for example black and white. One way to generate these is by applying a threshold on an image. Below we also show how to <em>invert</em> an image, by applying the transformation $1-x$ to each gray value $x$.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">image_threshold</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">th</span><span class="p">)</span>
    <span class="k">return</span> <span class="kt">Float64</span><span class="o">.</span><span class="p">(</span><span class="n">A</span> <span class="o">.&gt;</span> <span class="n">th</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">imshow_scale</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">.-</span> <span class="n">image_threshold</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_11_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Image-scaling">Image scaling<a class="anchor-link" href="#Image-scaling"> </a></h2><p>One imporatant image operation is <em>scaling</em>, that is, change the number of pixels along each direction of the image. First consider the so-called <em>downsampling</em> of an image by a factor of 2. While we could simply extract every second pixel in each row and each column, a slightly better option is to average the values in each 2-by-2 block:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">image_downsample</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="c"># For simplicity, ignore last row/column if size is odd</span>
    <span class="n">sz</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">sz2</span> <span class="o">=</span> <span class="n">sz</span> <span class="o">.÷</span> <span class="mi">2</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">:</span><span class="p">]</span> <span class="o">.+</span>
         <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">:</span><span class="p">]</span> <span class="o">.+</span>
         <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">:</span><span class="p">]</span> <span class="o">.+</span>
         <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="n">sz2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">:</span><span class="p">])</span> <span class="o">./</span> <span class="mi">4</span>
<span class="k">end</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">4</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">image_downsample</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="s"> levels downsampling&quot;</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_13_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>Upscaling</em> an image, that is, increasing its size, is a more difficult operation. Is is obviously impossible to know the intensity of the added pixels, but assuming the variations are small one can for example interpolate between the given values. One simple interpolation is <em>bilinear</em>, which for a factor of 2 simply becomes averaging between neighboring pixel values:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">image_upsample</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">sz</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="kt">Float32</span><span class="p">,</span> <span class="mi">2</span><span class="n">sz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="n">sz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sz</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">.=</span> <span class="n">A</span>
    <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">.=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">]</span> <span class="o">.+</span> <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">])</span> <span class="o">./</span> <span class="mi">2</span>
    <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">.=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span> <span class="o">.+</span> <span class="n">A</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="o">:</span><span class="p">])</span> <span class="o">./</span> <span class="mi">2</span>
    <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="p">]</span> <span class="o">.=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span> <span class="o">.+</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
                               <span class="o">.+</span>  <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span> <span class="o">.+</span> <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="mi">2</span><span class="o">:</span><span class="k">end</span><span class="p">,</span><span class="o">:</span><span class="p">])</span> <span class="o">./</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="n">B</span>
<span class="k">end</span>

<span class="n">D</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">4</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">image_upsample</span><span class="p">(</span><span class="n">D</span><span class="p">);</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="n">title</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="s"> levels upsampling&quot;</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_15_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The resulting image is of course much less detailed that the original, but that was expected since we reduced its size by a factor of $2^4=16$ in each direction:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">B</span><span class="p">);</span> <span class="n">title</span><span class="p">(</span><span class="s">&quot;Original&quot;</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">D</span><span class="p">);</span> <span class="n">title</span><span class="p">(</span><span class="s">&quot;Down+Up sampling&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_17_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Filtering">Filtering<a class="anchor-link" href="#Filtering"> </a></h2><p>In <em>spatial filtering</em> of an image, we apply a given function to the gray valeues in a neighborhood of each pixel. A simple example is a function which takes the average of the 3-by-3 mask obtained by considering a pixel and its immediate neighbors:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">image_avgfilter</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">A</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">B</span>
<span class="k">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>image_avgfilter (generic function with 1 method)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Smoothing">Smoothing<a class="anchor-link" href="#Smoothing"> </a></h3><p>If we apply the average filter several times, and zoom in a portion of the image, we can see that it has the effect of <em>smoothing</em>, or <em>blurring</em>, the image:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">filter_demo</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">filter_function</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">:</span><span class="mi">3</span>
        <span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">260</span><span class="o">:</span><span class="mi">350</span><span class="p">,</span><span class="mi">300</span><span class="o">:</span><span class="mi">420</span><span class="p">,</span><span class="o">:</span><span class="p">])</span>
        <span class="n">title</span><span class="p">(</span><span class="s">&quot;</span><span class="si">$</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="s"> times average filter&quot;</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">filter_function</span><span class="p">(</span><span class="n">E</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="n">tight_layout</span><span class="p">()</span>
<span class="k">end</span>
<span class="n">filter_demo</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">image_avgfilter</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_21_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, the average filter also tends to reduce certain types of noise, demonstrated below by adding normal distributed random numbers to the image:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Bnoise</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="mf">0.1</span><span class="n">randn</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">B</span><span class="p">))</span>   <span class="c"># Add noise</span>
<span class="n">Bnoise</span> <span class="o">=</span> <span class="n">max</span><span class="o">.</span><span class="p">(</span><span class="n">min</span><span class="o">.</span><span class="p">(</span><span class="n">Bnoise</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c"># Ensure values in [0,1]</span>
<span class="n">filter_demo</span><span class="p">(</span><span class="n">Bnoise</span><span class="p">,</span> <span class="n">image_avgfilter</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_23_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Median-filtering">Median filtering<a class="anchor-link" href="#Median-filtering"> </a></h3><p>A slight variation of the average filter is the <em>median filter</em>, which sets a pixel to the median of the gray values in the 3-by-3 neighboring mask:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">image_medianfilter</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">A</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">B</span>
<span class="k">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>image_medianfilter (generic function with 1 method)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The median filter is particularly good at removing noise that only affects a small number of pixels, which we model below by randomly changing only some of the pixels in the image:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Bnoise2</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="n">Bnoise2</span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">B</span><span class="p">),</span> <span class="mi">10000</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="n">rand</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">filter_demo</span><span class="p">(</span><span class="n">Bnoise2</span><span class="p">,</span> <span class="n">image_medianfilter</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_27_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Edge-detection">Edge detection<a class="anchor-link" href="#Edge-detection"> </a></h3><p>The previous filters tend to smooth or blur out noise and other sharp features in the image. Next we will do the opposite, and try to <em>detect</em> a sharp variation in gray values between neighboring pixels. This can be used to find the edges between regions in the image.</p>
<p>We will detect large changes using centered gradient approximations, that is:</p>
$$
\nabla A_{ij} \approx
\begin{pmatrix}
A_{i+1,j} - A_{i-1,j} \\
A_{i,j+1} - A_{i,j-1} \\
\end{pmatrix}
$$<p>Clearly one of these components will be either large positive or large negative if there is a big jump between neighboring values, so our filter will compute the maximum of the absolute values of the gradient:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">function</span> <span class="n">image_maxabsgradfilter</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">A</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="n">B</span>
<span class="k">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>image_maxabsgradfilter (generic function with 1 method)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To improve the edge detection, we first smooth the image using the average filter before applying the gradient filter:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Bsmooth</span> <span class="o">=</span> <span class="n">image_avgfilter</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
<span class="n">Bgrad</span> <span class="o">=</span> <span class="n">image_maxabsgradfilter</span><span class="p">(</span><span class="n">Bsmooth</span><span class="p">);</span>
<span class="n">imshow_scale</span><span class="p">(</span><span class="n">Bgrad</span><span class="p">);</span> <span class="n">title</span><span class="p">(</span><span class="s">&quot;Gradient filter&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_31_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we can threshold and invert the image to find the edges:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Bedges</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">.-</span> <span class="n">image_threshold</span><span class="p">(</span><span class="n">Bgrad</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">imshow_scale</span><span class="p">(</span><span class="n">Bedges</span><span class="p">);</span> <span class="n">title</span><span class="p">(</span><span class="s">&quot;Edge detection&quot;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_33_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Fourier-Transform">The Fourier Transform<a class="anchor-link" href="#The-Fourier-Transform"> </a></h2><p>The 2D discrete Fourier Transform decomposes a 2D array into a sum of complex exponentials:</p>
$$
f(x,y) = \frac{1}{mn} \sum_{u=0}^{m-1} \sum_{v=0}^{n-1} F(u,v)
  \exp \left[2\pi i \left(\frac{xu}{m} + \frac{yv}{n}\right) \right]
$$<p>where the <em>Fourier coefficients</em> are defined by</p>
$$
F(u,v) = \sum_{x=0}^{m-1} \sum_{y=0}^{n-1} f(x,y)
  \exp \left[-2\pi i \left(\frac{xu}{m} + \frac{yv}{n}\right) \right]
$$<p>They are useful in image processing for performing fast filtering, compression, detection of periodic features, etc.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First let us plot the Fourier coefficients of some simple images:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="k">using</span> <span class="n">FFTW</span>

<span class="k">function</span> <span class="n">imagefft_demo</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">AF</span> <span class="o">=</span> <span class="n">fftshift</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
    <span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="n">imshow_scale</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="p">(</span><span class="mi">1</span> <span class="o">.+</span> <span class="n">abs</span><span class="o">.</span><span class="p">(</span><span class="n">AF</span><span class="p">)));</span>
    <span class="k">return</span>
<span class="k">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>imagefft_demo (generic function with 1 method)</pre>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="p">[</span><span class="n">zeros</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span><span class="mi">128</span><span class="p">)</span> <span class="n">ones</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span><span class="mi">128</span><span class="p">)]</span>
<span class="n">imagefft_demo</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_37_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="n">G</span><span class="p">[</span><span class="mi">78</span><span class="o">:</span><span class="mi">178</span><span class="p">,</span> <span class="mi">78</span><span class="o">:</span><span class="mi">178</span><span class="p">]</span> <span class="o">.=</span> <span class="mf">1.0</span>
<span class="n">imagefft_demo</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_38_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="kt">Float32</span><span class="p">[</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">329</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">&gt;</span><span class="mi">182</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">&gt;-</span><span class="mi">67</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">73</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">256</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">256</span> <span class="p">]</span>
<span class="n">imagefft_demo</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_39_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="kt">Float32</span><span class="p">[</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="n">i</span> <span class="o">+</span> <span class="mi">20</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="mi">256</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">256</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="mi">256</span> <span class="p">]</span>
<span class="n">imagefft_demo</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_40_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Many of these patterns can be understood from the underlying Fourier expansion. However, for a general image the pattern of the Fourier spectrum is less clear. We would expect the coefficients from a relatively smooth image to decay away from the center though:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">imagefft_demo</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_42_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Removing-periodic-noise">Removing periodic noise<a class="anchor-link" href="#Removing-periodic-noise"> </a></h3><p>One application of image processing using the Fourier transform is to remove periodic noise. Below we demonstrate this using a made-up example with a given frequency and direction of the noise, but it can be made more general.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="n">Bpernoise</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="n">Bpernoise</span> <span class="o">=</span> <span class="n">B</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="kt">Float32</span><span class="p">[</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="nb">π</span><span class="o">*</span><span class="mi">10</span><span class="n">j</span> <span class="o">/</span> <span class="n">size</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="o">:</span><span class="n">size</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">]</span>
<span class="n">imagefft_demo</span><span class="p">(</span><span class="n">Bpernoise</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_44_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now compute the Fourier transform, and set the (known) noise frequencies to zero:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-julia"><pre><span></span><span class="c"># Filter</span>
<span class="n">BF</span> <span class="o">=</span> <span class="n">fftshift</span><span class="p">(</span><span class="n">fft</span><span class="p">(</span><span class="n">Bpernoise</span><span class="p">))</span>
<span class="n">mid</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">.÷</span> <span class="mi">2</span> <span class="o">.+</span> <span class="mi">1</span>
<span class="n">BF</span><span class="p">[</span><span class="n">mid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">BF</span><span class="p">[</span><span class="n">mid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Bfiltered</span> <span class="o">=</span> <span class="n">real</span><span class="o">.</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">BF</span><span class="p">)))</span>

<span class="n">imagefft_demo</span><span class="p">(</span><span class="n">Bfiltered</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/Image_Processing_46_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    